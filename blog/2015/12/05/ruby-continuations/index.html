
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruby Continuations - SotoSeattle</title>
  <meta name="author" content="Javier Soto">

  
  <meta name="description" content="Continuations are a useful device for many coding tasks. I like to visualize them as portals or wormholes that connect different parts of your code. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sotoseattle.github.io/blog/2015/12/05/ruby-continuations">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="" rel="alternate" title="SotoSeattle" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
<!-- MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["$$","$$"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner">
	<div class="header-title"><a href="/">SotoSeattle</a></div>


	<br><div class="header-subtitle">Developer of software, ideas, startups</div>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
<!--   <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li> -->
  
  <li class='icon'>
    <a href="https://github.com/sotoseattle/">
      <img src="/images/logos/github_icon.png" width="36" height="27">
      </img>
    </a>
  </li>
  <li class='icon'>
    <a href="https://www.linkedin.com/in/sotoseattle/">
      <img src="/images/logos/linkedin-256.png"  width="27" height="27">
      </img>
    </a>
  </li>
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sotoseattle.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
<!--   <li><a href="projects/">Projects</a></li> -->
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/images/Javier_Soto_resume.pdf">Resume</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
  
    
      <h1 class="entry-title">Ruby Continuations</h1>
    
  
    
      <p class="meta">
        








  


<time datetime="2015-12-05T12:14:40-08:00" pubdate data-updated="true">Dec 5<span>th</span>, 2015</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Continuations are a useful device for many coding tasks. I like to visualize them as portals or wormholes that connect different parts of your code. Continuations allow you to hyper-jump from one place of your executing code to another without missing a bit. The following is an example of how they can be used:</p>

<p><img class="center" src="/images/dec15/portal.jpg" width="800" />
<!--more--></p>

<blockquote>
  <p>Given a binary tree and two nodes A and B from within that tree, write a function to find the node which is the first common ancestor of A and B.</p>
</blockquote>

<p>You already know how to search binary trees, depth or breadth first, and you could just traverse the tree in search of the nodes and pick up the parents as you go along. That is not intrinsically difficult and there are many examples on the Internet. The problem is that you need to run through the whole tree every time you initiate a search. Could there be a way to stop moving along the tree once you find the node and simple return to sender? Yes, one way is with continuations.</p>

<p><img class="right" src="/images/dec15/treesearch.png" width="300" /></p>

<p>Intuitively what we want is something similar to the following:</p>

<ul>
  <li>We open a portal at the start of our journey, at the root or beginning of the tree. This portal is where we want to go back to when we find The Node. It is our way to get back home as we get lost in the multiverse of recurring calls through the tree.</li>
  <li>Once we secure a way back, we jump in the rabbit hole, we start searching the tree, going from node to node, a dazzling pin-ball.</li>
  <li>As we go along, as we search for The Node, we keep a bread crumb track of the path taken.</li>
  <li>After many jumps between nodes, already disoriented, we arrive to The Node we were after. But, alas! our tree is made of nodes that do not link upwards to parents, only downwards to children, so we cannot use our bread crumbs to dig ourselves back to the root!</li>
  <li>Yet we have an opened portal at the root and, as we all know from Cosmology 101, we can always open the other end of the wormhole with our sonic screwdriver and get back to safety.</li>
</ul>

<p>The final code would look like the following. I leave up to you to make sense of the details (the Internet is full of better explanations than this one :-).</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">module</span> <span class="nn">Ancestry</span>
</span><span class="line">  <span class="nb">require</span> <span class="s1">&#39;continuation&#39;</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">ancestors</span> <span class="n">node</span>
</span><span class="line">    <span class="n">portal</span> <span class="o">=</span> <span class="nb">callcc</span> <span class="p">{</span><span class="o">|</span><span class="n">cont</span><span class="o">|</span> <span class="n">cont</span><span class="p">}</span>                   <span class="c1"># open cosmological-portal (brrrrzzzzzuinga!!)</span>
</span><span class="line">
</span><span class="line">    <span class="k">return</span> <span class="n">portal</span> <span class="k">unless</span> <span class="n">portal</span><span class="o">.</span><span class="n">is_a?</span> <span class="no">Continuation</span>  <span class="c1"># return whatever was sent through the portal</span>
</span><span class="line">
</span><span class="line">    <span class="n">find</span> <span class="n">node</span><span class="p">,</span> <span class="o">[]</span><span class="p">,</span> <span class="n">portal</span>                           <span class="c1"># go down the rabbit hole in search of node</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">find</span> <span class="n">n</span><span class="p">,</span> <span class="n">crumbtrail</span><span class="p">,</span> <span class="n">getaway</span>
</span><span class="line">    <span class="n">getaway</span><span class="o">.</span><span class="n">call</span> <span class="n">crumbtrail</span> <span class="k">if</span> <span class="nb">self</span> <span class="o">==</span> <span class="n">n</span>            <span class="c1"># if found, send ancestry logbook through the portal</span>
</span><span class="line">
</span><span class="line">    <span class="p">(</span><span class="vi">@left</span>  <span class="o">&amp;&amp;</span> <span class="vi">@left</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">n</span><span class="p">,</span> <span class="n">crumbtrail</span> <span class="o">+</span> <span class="o">[</span><span class="nb">self</span><span class="o">]</span><span class="p">,</span> <span class="n">getaway</span><span class="p">))</span> <span class="o">||</span>
</span><span class="line">    <span class="p">(</span><span class="vi">@right</span> <span class="o">&amp;&amp;</span> <span class="vi">@right</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">crumbtrail</span> <span class="o">+</span> <span class="o">[</span><span class="nb">self</span><span class="o">]</span><span class="p">,</span> <span class="n">getaway</span><span class="p">))</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">common_ancestor</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
</span><span class="line">    <span class="p">(</span><span class="nb">ancestors</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">ancestors</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="o">.</span><span class="n">last</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Bintree</span>
</span><span class="line">  <span class="kp">include</span> <span class="no">Ancestry</span>
</span><span class="line">  <span class="kp">attr_accessor</span> <span class="ss">:val</span><span class="p">,</span> <span class="ss">:left</span><span class="p">,</span> <span class="ss">:right</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">val</span>
</span><span class="line">    <span class="vi">@left</span> <span class="o">=</span> <span class="vi">@right</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class="line">    <span class="vi">@val</span> <span class="o">=</span> <span class="n">val</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Javier Soto</span></span>

      








  


<time datetime="2015-12-05T12:14:40-08:00" pubdate data-updated="true">Dec 5<span>th</span>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ruby/'>Ruby</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://sotoseattle.github.io/blog/2015/12/05/ruby-continuations/" data-via="" data-counturl="http://sotoseattle.github.io/blog/2015/12/05/ruby-continuations/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/03/04/Seattlerb-GoL/" title="Previous Post: Seattle Ruby Game Of Life">&laquo; Seattle Ruby Game Of Life</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/12/05/ruby-continuations/">Ruby Continuations</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/04/Seattlerb-GoL/">Seattle Ruby Game Of Life</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/01/CodeFellows/">Article Published</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/15/Scheme-GOL/">Game of Life in Scheme</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/18/4-PSD/">4 Principles of Simple Design Reflections</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 -  Javier Soto <br/>
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> + <a href="https://github.com/ioveracker/mnml">mnml</a>.
	  
  </span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sotoseattle';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sotoseattle.github.io/blog/2015/12/05/ruby-continuations/';
        var disqus_url = 'http://sotoseattle.github.io/blog/2015/12/05/ruby-continuations/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
