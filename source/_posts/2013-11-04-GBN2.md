---
layout: post
title: "Genetic Bayesian Network (II)"
date: 2013-11-04 08:01
comments: true
categories: PGN, genetic
---

[UPDATE] I have updated a posteriori the code to include the vectorized version of Factor manipulations, which is incredibly faster and will be explained in a later post.

## an example: cystic fibrosis

Let's create a network for the Cystic Fibrosis. It is expressed through two possible alleles: F and f, where F is dominant. The alleles can take the following genetic forms: FF, Ff, and ff. Given a pedigree like the one bellow lets build a Bayesian network and run some inference.

{% img center /images/nov13/cysticBN.png 500 Template for Genetic Bayesian Network%}

```python creating genetic Bayesian network
family_tree = {}
family_tree['Ira'] = [None, None]
family_tree['Robin'] = [None, None]
family_tree['Aaron'] = [None, None]
family_tree['Rene'] = [None, None]
family_tree['James'] = ['Ira', 'Robin']
family_tree['Eva']   = ['Ira', 'Robin']
family_tree['Sandra'] = ['Aaron', 'Eva']
family_tree['Jason'] = ['James', 'Rene']
family_tree['Benito'] = ['James', 'Rene']

frequency_of_alleles_in_general_population = [0.1, 0.9]
probability_of_trait_based_on_genotype = [0.8, 0.6, 0.1]

TRAIT_PRESENT, TRAIT_ABSENT = [0,1]
FF, Ff, ff = [0,1,2]

# building the network

GN = geneticNetwork(family_tree, frequency_of_alleles_in_general_population, probability_of_trait_based_on_genotype)
```

The main problem is that, so far, the way we are computing probabilities is by multiplying factors together, which means creating a CPD for the whole universe of possible assignments of all random variables (nodes). This super table takes into consideration all possible states, all possible scenarios, and therefore is huge. It used to take a very long time to compute it when using loops for the factor operations (a matter of hours), now with a vectorized version (see later post) it takes less than 3 seconds.

```python running the network
# Evidence conditioning
modify_Factor_by_evidence('Ira',   'pheno', TRAIT_PRESENT)
modify_Factor_by_evidence('James', 'geno', Ff)
modify_Factor_by_evidence('Rene',  'geno', FF)

# lets try first the whole kahuna CPD and compute the prob of developing CF
a = build_joint_cpd()

# marginalizing
target = GN['Benito']['var_pheno']
lista = [x for x in a.variables if x!=target]
for v in lista:
    a = FactorOperations.marginalize(a, v)

# the result
print 'probability of Benito showing ailment', 100.*a.values[0], '%'
```

In an initial state, without more information, the probability for Benito developing Cystic Fibrosis is 19.70%. It is not even necessary to infer this from the network (although it is possible) since it is the weighted average of the genotype distribution ```0.197 = (0.01*0.8)+(0.18*0.6)+(0.81*0.1)```.

Now, if his grandfather Ira had the ailment, (the trait was present as expressed in phenotype and suffered the disease), the chances of Benito being in the same situation raises to 24.75%

Furthermore, his parents did a genetic test prior to having children and they know that Jame's genotype is Ff and that Rene's is FF. Now the probability has risen again to 70%.

